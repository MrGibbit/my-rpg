    :root{
      --bg:#0b0f14; --panel:#121a23; --panel2:#0f161f; --text:#e6eef7; --muted:#a9b7c6;
      --accent:#5eead4; --warn:#fbbf24; --bad:#fb7185;
    }

    html,body{ height:100%; }
    body{
      margin:0;
      background:radial-gradient(1200px 800px at 30% 20%, #162233, var(--bg));
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;
      overflow:hidden;
      user-select:none;
    }

    .wrap{ height:100vh; width:100vw; }
    .gameArea{
      position:relative;
      width:100%;
      height:100%;
      overflow:hidden;
    }

    canvas#c{
      width:100%;
      height:100%;
      image-rendering:pixelated;
      background:#0a1119;
      display:block;
      cursor:crosshair;
    }

    /* ---------- HP HUD (top-left overlay) ---------- */
    .hudTopLeft{
      position:absolute;
      left:12px;
      top:12px;
      z-index:58;
      pointer-events:none;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .hpCard{
      pointer-events:none;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(10,16,24,.45);
      box-shadow:0 18px 40px rgba(0,0,0,.30);
      backdrop-filter:blur(6px);
      padding:10px 12px;
      min-width:220px;
    }
    .hpRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-weight:900;
      font-size:12px;
      color:rgba(230,238,247,.92);
      letter-spacing:.2px;
    }
    .hpBar{
      margin-top:8px;
      height:12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      overflow:hidden;
    }
    .hpBar > div{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(251,113,133,.90), rgba(239,68,68,.95));
    }
    /* ---------- Coords HUD (under HP card) ---------- */
    .coordCard{
      pointer-events:none;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(10,16,24,.35);
      box-shadow:0 14px 34px rgba(0,0,0,.28);
      backdrop-filter:blur(6px);
      padding:8px 10px;
      min-width:160px;
      font-size:12px;
      color:rgba(230,238,247,.92);
    }
    .coordRow{
      display:flex;
      align-items:center;
      gap:8px;
      line-height:1.2;
      margin:3px 0;
    }
    .coordKey{
      width:16px;
      font-weight:900;
      color:rgba(169,183,198,.90);
    }
    .coordVal{
      font-weight:900;
      font-variant-numeric:tabular-nums;
      letter-spacing:.2px;
    }


    /* ---------- Top-right HUD: minimap + toolbar ---------- */
    .hudTopRight{
      position:absolute;
      right:12px;
      top:12px;
      display:flex;
      flex-direction:row;
      align-items:flex-start;
      gap:10px;
      z-index:60;
      pointer-events:none;
    }

    .minimapFrame{
      pointer-events:auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-end;
    }

    canvas#minimap{
      width:150px;
      height:150px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      image-rendering:pixelated;
      box-shadow:0 18px 40px rgba(0,0,0,.35);
    }

    .iconBar{
      pointer-events:auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
    }

    .iconBtn{
      width:44px;
      height:44px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(10,16,24,.50);
      color:var(--text);
      font-size:18px;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 18px 40px rgba(0,0,0,.30);
      backdrop-filter:blur(6px);
      user-select:none;
    }
    .iconBtn:hover{ background:rgba(255,255,255,.10); }
    .iconBtn.active{
      outline:2px solid rgba(94,234,212,.55);
      background:rgba(94,234,212,.14);
    }
    .iconBtn.disabled{
      opacity:.35;
      cursor:not-allowed;
      outline:none;
    }

    /* ---------- Floating windows ---------- */
    .window{
  position:absolute;
  left:18px;
  top:70px;
  width:360px;
  height:420px;
  border-radius:16px;
  background:rgba(15,22,31,.92);
  border:1px solid rgba(255,255,255,.14);
  box-shadow:0 22px 60px rgba(0,0,0,.55);
  backdrop-filter:blur(7px);
  z-index:70;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  resize: both;

  /* Floors/ceilings so menus don't open “collapsed” and never go off-screen */
  --minW: 320px;
  --minH: 320px;
  min-width:  min(var(--minW), calc(100% - 16px));
  min-height: min(var(--minH), calc(100% - 16px));
  max-width:  calc(100% - 16px);
  max-height: calc(100% - 16px);

  pointer-events:auto;
}
.window.hidden{ display:none; }

/* Per-window minimum sizes (prevents “drag-to-see” after a player resized smaller) */
#winInventory{ --minW: 340px; --minH: 420px; }
#winEquipment{ --minW: 320px; --minH: 340px; }
#winSkills{ --minW: 460px; --minH: 460px; }
#winBank{ --minW: 420px; --minH: 460px; }
#winVendor{ --minW: 420px; --minH: 460px; }
#winSettings{ --minW: 320px; --minH: 280px; }

/* Small screens: relax mins */
@media (max-width: 720px), (max-height: 720px){
  .window{ --minW: 280px; --minH: 240px; }
  #winSkills{ --minW: 320px; --minH: 320px; }
  #winBank{ --minW: 320px; --minH: 360px; }
  #winVendor{ --minW: 320px; --minH: 360px; }
}


    .winHeader{
      height:42px;
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:8px 10px;
      cursor:move;
      border-bottom:1px solid rgba(255,255,255,.10);
      user-select:none;
    }
    .winHeader .title{
  font-weight:800;
  letter-spacing:.2px;
  display:flex;
  align-items:center;
  gap:8px;

  /* allow header content to shrink so the close button never gets pushed off */
  flex: 1 1 auto;
  min-width: 0;
  overflow: hidden;
}

    .winHeader .pill{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
      background:rgba(0,0,0,.12);
      white-space:nowrap;
    }
    .winClose{
  flex: 0 0 auto;

      width:34px;
      height:30px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
    }
    .winClose:hover{ background:rgba(255,255,255,.10); }

    .winBody{
      flex:1 1 auto;
      min-height:0;
      padding:10px 10px 18px;

      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden;
    }

    .hint{ font-size:12px; color:var(--muted); line-height:1.35; }
    .small{ font-size:11px; color:var(--muted); }
/* Settings rows (ex: Audio in Settings window) */
.settingRow{
  display:flex;
  align-items:center;
  gap:10px;
}
.settingRow input[type="range"]{
  flex:1 1 auto;
  min-width:140px;
}
.chk{
  display:flex;
  align-items:center;
  gap:6px;
  user-select:none;
}


    /* Inventory grid */
    .inv{
      flex:1 1 auto;
      min-height:0;
      overflow:auto;
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:8px;
      padding-right:2px;
    }
    .slot{
      aspect-ratio:1/1;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      user-select:none;
      cursor:default;
      padding:6px;
      gap:4px;
    }
    .slot.empty{ opacity:.6; }
    .slot .icon{ font-size:20px; line-height:1; filter:drop-shadow(0 1px 2px rgba(0,0,0,.5)); }
    .slot .name{ font-size:10px; text-align:center; color:#dbe7f4; padding:0 6px; line-height:1.1; }
    .slot .qty{
      position:absolute; bottom:6px; right:8px;
      font-size:11px; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.7);
    }

    /* Skills list */
    .skillsGrid{
      flex:1 1 auto;
      min-height:0;
      overflow:auto;
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:8px;
      padding-right:2px;
    }
    .stat{
      padding:10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.15);
    }
    .stat .k{ font-size:12px; color:var(--muted); display:flex; align-items:center; gap:6px; }
    .stat .k .ico{ font-size:16px; line-height:1; }
    .stat .v{ font-size:16px; font-weight:800; margin-top:2px; }
    .bar{
      height:10px; border-radius:999px; border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22); overflow:hidden; margin-top:8px;
    }
    .bar > div{ height:100%; width:0%; background:linear-gradient(90deg, rgba(94,234,212,.8), rgba(96,165,250,.8)); }

    /* Melee training selector */
    .seg{
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:wrap;
    }
    .segLabel{
      font-size:12px;
      color:var(--muted);
      margin-right:6px;
      font-weight:700;
    }
    .segBtn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      font-size:12px;
    }
    .segBtn.active{
      outline:2px solid rgba(94,234,212,.55);
      background:rgba(94,234,212,.14);
    }
/* Vendor / Shop */
.shopPane{
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding-right: 2px;
}

.shopRow{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 12px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
}

.shopLeft{
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

.shopIcon{
  width: 34px;
  height: 34px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.25);
  border: 1px solid rgba(255,255,255,0.10);
  font-size: 18px;
}

.shopMeta{
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.shopName{
  font-weight: 700;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.shopSub{
  font-size: 12px;
  opacity: 0.75;
}

.shopActions{
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.shopBtn{
  padding: 8px 10px;
  border-radius: 12px;
}

    .segBtn:hover{ background:rgba(255,255,255,.10); }

    /* Equipment window */
    .equipGrid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      flex:1 1 auto;
      min-height:0;
      overflow:auto;
      padding-right:2px;
    }
    .equipSlot{
      display:flex;
      gap:10px;
      align-items:center;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.16);
      padding:10px;
      cursor:pointer;
    }
    .equipSlot:hover{ background:rgba(255,255,255,.06); }
    .equipSlot .slotBox{
      width:56px; height:56px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
      flex:0 0 auto;
    }
    .equipSlot .meta{ flex:1; min-width:0; }
    .equipSlot .meta .k{ font-size:12px; color:var(--muted); }
    .equipSlot .meta .v{ font-weight:850; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .btnrow{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    button{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
    }
    button:hover{ background:rgba(255,255,255,.10); }
    button:active{ transform:translateY(1px); }

    /* ---------- Chat (bottom-left HUD, resizable + collapsible) ---------- */
    .hudChat{
      position:absolute;
      left:12px;
      bottom:12px;
      width:420px;
      height:320px;
      z-index:55;
      pointer-events:none;
    }

    .hudChat.collapsed{
      width:auto !important;
      height:auto !important;
    }

    .hudChatTab{
      display:none;
      pointer-events:auto;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(10, 16, 24, 0.45);
      color:var(--text);
      padding:8px 10px;
      font-weight:900;
      cursor:pointer;
      backdrop-filter:blur(6px);
      user-select:none;
    }
    .hudChat.collapsed .hudChatTab{ display:inline-flex; }

    .hudChatCard{
      position:relative;
      width:100%;
      height:100%;
      border-radius:14px;
      padding:10px;

      background:rgba(10, 16, 24, 0.45);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 18px 40px rgba(0,0,0,.35);
      backdrop-filter:blur(6px);

      pointer-events:none;

      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden;
    }

    .hudChat.collapsed .hudChatCard{ display:none; }

    .hudChatHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      pointer-events:auto;
      cursor:move;
      user-select:none;
      flex:0 0 auto;
    }
    .hudChatHeaderRight{
      display:flex;
      align-items:center;
      gap:8px;
    }

    .hudChatMin{
      pointer-events:auto;
      flex:0 0 auto;
      width:34px;
      padding:6px 0;
      border-radius:10px;
      font-weight:900;
    }

    .hudChatBody{
      flex:1 1 auto;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
      pointer-events:none;
      overflow:hidden;
    }

    .chatLog{
      flex:1 1 auto;
      min-height:0;
      overflow-y:auto;
      font-size:12px;
      line-height:1.35;
      color:#d6e2ef;
      pointer-events:auto;
      padding-right:2px;
    }
    .chatLog p{ margin:0 0 8px; }
    .chatLog .muted{ color:var(--muted); }
    .chatLog .good{ color:#86efac; }
    .chatLog .warn{ color:var(--warn); }
    .chatLog .bad{ color:var(--bad); }

    .chatInputRow{
      display:flex;
      gap:8px;
      pointer-events:auto;
      flex:0 0 auto;
    }
    input.chatInput{
      flex:1;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }

    .hudChatResize{
      position:absolute;
      right:6px;
      bottom:6px;
      width:16px;
      height:16px;
      border-radius:6px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      cursor:nwse-resize;
      pointer-events:auto;
    }
    .hudChatResize:after{
      content:"";
      position:absolute;
      right:3px;
      bottom:3px;
      width:8px;
      height:8px;
      border-right:2px solid rgba(255,255,255,.35);
      border-bottom:2px solid rgba(255,255,255,.35);
    }

    /* ---------- Custom right-click context menu ---------- */
    .ctxmenu{
      position:fixed; min-width:200px;
      background:rgba(15,22,31,.96);
      border:1px solid rgba(255,255,255,.14);
      border-radius:12px;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      padding:6px; z-index:9999; backdrop-filter:blur(6px);
    }
    .ctxmenu.hidden{ display:none; }
    .ctxmenu button{
      width:100%;
      text-align:left;
      padding:9px 10px;
      border-radius:10px;
      border:1px solid transparent;
      background:transparent;
      color:rgba(230,238,247,.95);
      font-weight:800;
      cursor:pointer;
    }
    .ctxmenu button:hover{ background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.08); }

    .ctxmenu .sep{ height:1px; margin:6px 4px; background:rgba(255,255,255,.10); }

    /* ---------- Modals (character create + delete confirm) ---------- */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:flex; align-items:center; justify-content:center;
      z-index:9998;
      backdrop-filter:blur(4px);
    }
    .modal{
      width:min(520px, 92vw);
      border-radius:16px;
      background:rgba(15,22,31,.98);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 22px 60px rgba(0,0,0,.55);
      padding:14px;
      user-select:text;
    }
    .modal h2{ margin:6px 0 10px; font-size:16px; }
    .modal .sub{ font-size:12px; color:var(--muted); margin:0 0 10px; line-height:1.35; }
    .modal .formRow{ display:flex; gap:10px; align-items:center; margin:10px 0; }
    .modal label{ font-size:12px; color:var(--muted); min-width:110px; }
    .modal input[type="text"]{
      flex:1;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }

    .classPick{ display:flex; gap:8px; flex-wrap:wrap; }
    .classBtn{
      flex:0 0 auto;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
    }
    .classBtn.active{
      outline:2px solid rgba(94,234,212,.55);
      background:rgba(94,234,212,.10);
    }

    .useState{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .pill{
      font-size:12px; padding:4px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12); color:var(--muted);
      background:rgba(0,0,0,.12);
    }